@model JiraTicketingToolViewModel

<style>
    .form-heading {
        background-color: #f2f2f2;
        padding: 10px;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
    }

    form {
        background-color: #fff;
        padding: 20px;
        border: 1px solid #ccc;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    select {
        width: 100%;
        height: 40px;
        padding: 5px;
        font-size: 16px;
        margin-bottom: 10px;
        box-sizing: border-box;
    }

    .required:after {
        content: "*";
        color: red;
        margin-left: 5px;
    }

    #reset-btn {
        float: right;
        margin-bottom: 10px;
    }
</style>

<div class="form-heading">Jira Ticketing Tool</div>

<form>
    <div>
        <label for="Initiative-dropdown">Initiatives<span class="required"></span></label>
        @Html.DropDownListFor(m => m.SelectedInitiative, Model.InitiativeSelectList, "Select an Initiative", new { @class = "js-select2" })
    </div>
    <div>
        <label for="project-dropdown">Project List<span class="required"></span></label>
        @Html.DropDownListFor(m => m.SelectedProject, Model.ProjectSelectList, "Select a project", new { @class = "js-select2" })

    </div>
    <div>
        <label for="epic-dropdown">Epic List<span class="required"></span></label>
        @Html.DropDownListFor(m => m.SelectedEpic, Model.EpicSelectList, "Select an epic", new { @class = "js-select2" })

    </div>
     <div>
        <label for="Task-dropdown">Task List<span class="required"></span></label>
        @Html.DropDownListFor(m => m.SelectedTask, Model.TaskSelectList, "Select a Task", new { @class = "js-select2" })

    </div>


    <button type="button" id="reset-btn" class="btn btn-primary">Reset</button>
</form>
@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

    <script>
        $(function () {
            // Initialize Select2 dropdowns
            $('.js-select2').select2();

            // Handle reset button click
            // Handle reset button click
            $('#reset-btn').on('click', function () {
                $('.js-select2').val(null).trigger('change');

            });


            // Handle description dropdown change event
            $('#SelectedInitiative').on('change', function () {
                var description = $(this).val();
                if (description) {
                    $.ajax({
                        url: '@Url.Action("GetProjects", "JiraTicketingTool")',
                        data: { description: description },
                        type: 'GET',
                        dataType: 'json',
                        success: function (data) {
                            var projectDropdown = $('#SelectedProject');
                            projectDropdown.empty();
                            projectDropdown.append($('<option>').text('ProjectList').attr('value', ''));
                            $.each(data, function (index, item) {
                                projectDropdown.append($('<option>').text(item.text).attr('value', item.value));
                            });
                            projectDropdown.trigger('change');
                        }
                    });
                }
                else {
                    var projectDropdown = $('#SelectedProject');
                    projectDropdown.empty();
                    projectDropdown.append($('<option>').text('ProjectList').attr('value', ''));
                    projectDropdown.trigger('change');
                }
            });

            $('#SelectedProject').on('change', function () 
            {
                var InitiativeName = $('#SelectedInitiative').val();
                var ProjectName = $(this).val();
               

                if (InitiativeName != "" && ProjectName != "") {
                    $.ajax({
                        url: '@Url.Action("GetEpics", "JiraTicketingTool")',
                        data: { description: InitiativeName, project: ProjectName },
                        type: 'GET',
                        dataType: 'json',
                        success: function (data) {
                            var epicDropdown = $('#SelectedEpic');
                            epicDropdown.empty();
                            epicDropdown.append($('<option>').text('EpicList').attr('value', ''));
                            $.each(data, function (index, item) {
                                epicDropdown.append($('<option>').text(item.text).attr('value', item.value));
                            });
                            epicDropdown.trigger('change');
                        }
                    });
                }
                else {
                    var epicDropdown = $('#SelectedEpic');
                    epicDropdown.empty();
                    epicDropdown.append($('<option>').text('EpicList').attr('value', ''));
                    epicDropdown.trigger('change');
                }
            });

            $('#SelectedEpic').on('change', function () {
                var EpicName = $(this).val();
                var ProjectName = $('#SelectedProject').val();
               
                 if (ProjectName != "" && EpicName != "") {
                    $.ajax({
                        url: '@Url.Action("GetTasks", "JiraTicketingTool")',
                        data: { description: EpicName, project: ProjectName },
                        type: 'GET',
                        dataType: 'json',
                        success: function (data) {
                            var TaskDropdown = $('#SelectedTask');
                            TaskDropdown.empty();
                            TaskDropdown.append($('<option>').text('TaskList').attr('value', ''));
                            $.each(data, function (index, item) {
                                TaskDropdown.append($('<option>').text(item.text).attr('value', item.value));
                            });
                            TaskDropdown.trigger('change');
                        }
                    });
                }
                else {
                    var TaskDropdown = $('#SelectedTask');
                    TaskDropdown.empty();
                    TaskDropdown.append($('<option>').text('TaskList').attr('value', ''));
                    TaskDropdown.trigger('change');
                }
            });

           

        });


    </script>
}
